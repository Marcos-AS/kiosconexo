<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

    <a href="compras.html">Registrar compra a proveedor y ver compras hechas</a><br>
    <a href="lista-compras.html">Lista de compras (para ir a comprar al proveedor)</a><br>
    <a href="decomisacion.html">Decomisaciones</a>
    <br>
    <a href="historial_compras.html">Historial de compras por producto</a>
    <a href="agregar_promocion_combinada.html">Promociones</a>

    <form action="" id="ingresar">
    <label for="ean">EAN</label>
    <input type="text" id="ean" autofocus>

    <label for="nombre">Nombre</label>
    <input type="text" id="nombre" >

    <label for="stock">Stock</label>
    <input type="number" id="stock" min="0">

    <label for="gramos">Gramos (opcional)</label>
    <input type="number" name="" id="gramos" step="any">
    <input type="checkbox" id="fijarGramos" title="Mantener estos gramos para el pr√≥ximo ingreso"> Fijar gramos

    <label for="categoria">Categoria</label>
    <input type="text" id="categoria" list="listaCategorias">
    <datalist id="listaCategorias"></datalist>
    <input type="checkbox" id="fijarCategoria" title="Mantener esta categor√≠a para el pr√≥ximo ingreso"> Fijar categor√≠a
    
    <label for="descripcion">Descripci√≥n (opcional)</label>
    <input type="text" id="descripcion">
    
    <label for="marca">Marca</label>
    <input type="text" name="" id="marca">
    <datalist id="listaMarcas"></datalist>
    <input type="checkbox" id="fijarMarca" title="Mantener esta marca para el pr√≥ximo ingreso"> Fijar marca
    <button form="ingresar" class="btn-ingresar">Ingresar</button>
    </form>

    <a href="ventas.html">Registrar Venta</a>
    <hr><br>
    <a href="ganancias.html">Ver Ganancias por Lote</a>
    <br>
    <button id="btn-informe-compras">Exportar informe de compras a PDF</button>
    
    <h1>Inventario</h1>

    <label for="buscarEan">Buscar por EAN:</label>
    <input type="text" id="buscarEan" placeholder="Ingrese EAN">
    <button id="btnBuscarEan">Buscar</button>
    <button id="btnLimpiarEan">Limpiar B√∫squeda</button>

    <label for="buscarNombre">Buscar por Nombre:</label>
    <input type="text" id="buscarNombre" placeholder="Ingrese Nombre del Producto">
    <button id="btnBuscarNombre">Buscar</button>
    <button id="btnLimpiarNombre">Limpiar B√∫squeda</button>

    <label for="filtroCategoria">Filtrar por categor√≠a</label>
    <select id="filtroCategoria"></select>

    <label for="filtroProveedor">Filtrar por proveedor</label>
    <select name="" id="filtroProveedor">
        <option value="">-- Mostrar todos --</option>
    </select>

    <label for="filtroMarca">Filtrar por marca</label>
    <select id="filtroMarca">
        <option value="">-- Mostrar todos --</option>
    </select>

    <label>
    <input type="checkbox" id="filtroStock"> Mostrar solo productos con stock
    </label>

    <table border="1">
        <thead>
            <tr>
                <th>EAN</th>
                <th>Nombre</th>
                <th>Stock</th>
                <th>Precio de venta</th>
                <th>Gramos</th>
                <th>Descripci√≥n</th>
                <th>Marca</th>
                <th>Categor√≠a</th>
                <th>Precio proveedor</th>
            </tr>
        </thead>
        <tbody id="lista-productos">

        </tbody>
    </table>

    <script>
        const inputMarca = document.getElementById('marca');
        const datalist = document.getElementById('listaMarcas');
        const botonAgregar = document.getElementById('agregarBtn');

        inputMarca.addEventListener('input', async () => {
            const texto = inputMarca.value;

            if (texto.length < 1) {
                datalist.innerHTML = '';
                return;
            }

            try {
                const res = await fetch(`/buscar-marcas?q=${encodeURIComponent(texto)}`);
                const marcas = await res.json();

                datalist.innerHTML = ''; // Limpiar sugerencias

                marcas.forEach(marca => {
                    const option = document.createElement('option');
                    option.value = marca;
                    datalist.appendChild(option);
                });
            } catch (err) {
                console.error('Error al buscar marcas:', err);
            }
        });

    const form = document.getElementById('ingresar');
    const lista = document.getElementById('lista-productos');
    const fijarCategoriaCheckbox = document.getElementById('fijarCategoria');
    const fijarMarcaCheckbox = document.getElementById('fijarMarca');
    const fijarGramosCheckbox = document.getElementById('fijarGramos');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const data = {
            ean: document.getElementById('ean').value.trim(),
            nombre: document.getElementById('nombre').value.trim(),
            stock: parseInt(document.getElementById('stock').value) || 0,
            gramos: document.getElementById('gramos').value.trim(),
            descripcion: document.getElementById('descripcion').value.trim(),
            marca: document.getElementById('marca').value.trim(),
            categoria: document.getElementById('categoria').value.trim()
        };

        try {
            const res = await fetch('/productos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const mensaje = await res.text();
            alert(mensaje);

            if (res.ok) {
                await cargarProductos();
                cargarCategoriasSelect();
                cargarMarcasFiltro();

                const categoriaFija = fijarCategoriaCheckbox.checked;
                const marcaFija = fijarMarcaCheckbox.checked;
                const gramosFijo = fijarGramosCheckbox.checked;

                const categoriaValue = categoriaFija ? data.categoria : '';
                const marcaValue = marcaFija ? data.marca : '';
                const gramosValue = gramosFijo ? data.gramos : '';

                form.reset();

                document.getElementById('categoria').value = categoriaValue;
                document.getElementById('marca').value = marcaValue;
                document.getElementById('gramos').value = gramosValue;

                fijarCategoriaCheckbox.checked = categoriaFija;
                fijarMarcaCheckbox.checked = marcaFija;
                fijarGramosCheckbox.checked = gramosFijo;

                document.getElementById('ean').focus();
            }
        } catch (err) {
            console.error('Error al enviar producto:', err);
            alert('Error al enviar producto');
        }
    });

    async function cargarCategorias() {
        try {
        const res = await fetch('/categorias');
        const data = await res.json();

        const lista = document.getElementById('listaCategorias');
        lista.innerHTML = '';
        data.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.nombre;
            lista.appendChild(option);
        });
        } catch (e) {
        console.error('Error al cargar categor√≠as:', e);
        }
    }

    
    let filtroStockActivo = false;

document.getElementById('filtroStock').addEventListener('change', function() {
    filtroStockActivo = this.checked;
    filtrarProductos();
});

async function filtrarProductos() {
    const categoriaId = document.getElementById('filtroCategoria').value;
    const proveedorId = document.getElementById('filtroProveedor').value;
    const marcaId = document.getElementById('filtroMarca').value;
    const eanBuscado = document.getElementById('buscarEan').value.trim();
    const nombreBuscado = inputBuscarNombre.value.trim();

    let url = '/productos';
    const params = new URLSearchParams();

    if (categoriaId) {
        params.append('categoriaId', categoriaId);
    }
    if (proveedorId) {
        params.append('proveedorId', proveedorId);
    }
    if (marcaId) {
        params.append('marcaId', marcaId);
    }
    if (eanBuscado) {
        params.append('ean', eanBuscado);
    }
    if (nombreBuscado) {
        params.append('nombre', nombreBuscado);
    }

    if (params.toString()) {
        url += `?${params.toString()}`;
    }

    const res = await fetch(url);
    let data = await res.json();

    // Aplica el filtro de stock aqu√≠, combinando con los dem√°s
    if (filtroStockActivo) {
        data = data.filter(prod => prod.stock > 0);
    }

    mostrarProductos(data);
}

    async function cargarProductos() {
    try {
        const res = await fetch('/productos');
        let productos = await res.json();

        // Elimina este bloque, ya no filtra por stock aqu√≠
        // if (filtroStockActivo) {
        //     productos = productos.filter(prod => prod.stock > 0);
        // }

        mostrarProductos(productos);
    } catch (e) {
        console.error('Error al cargar productos:', e);
    }
}


    function cargarCategoriasSelect() {
        fetch('/categorias')
            .then(res => res.json())
            .then(data => {
                // Ordenar alfab√©ticamente por nombre
                data.sort((a, b) => a.nombre.localeCompare(b.nombre));
                const select = document.getElementById('filtroCategoria');
                select.innerHTML = '<option value="">-- Mostrar todos --</option>';
                data.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.nombre;
                    select.appendChild(option);
                });
            });
    }

    async function cargarMarcasFiltro() {
        try {
            const res = await fetch('/marcas');
            const data = await res.json();
            // Ordenar alfab√©ticamente por nombre
            data.sort((a, b) => a.nombre.localeCompare(b.nombre));
            const select = document.getElementById('filtroMarca');
            select.innerHTML = '<option value="">-- Mostrar todos --</option>';
            data.forEach(marca => {
                const option = document.createElement('option');
                option.value = marca.id;
                option.textContent = marca.nombre;
                select.appendChild(option);
            });
        } catch (e) {
            console.error('Error al cargar marcas para el filtro:', e);
        }
    }

    // Mostrar productos en la tabla (funci√≥n reutilizable)
function mostrarProductos(productos) {
    const tbody = document.getElementById('lista-productos');
    tbody.innerHTML = '';

    // Cargar proveedores y todos los precios
    Promise.all([
        fetch('/proveedores').then(res => res.json()),
        fetch('/precios-todos').then(res => res.json())
    ]).then(([proveedores, preciosTodos]) => {
        productos.forEach(prod => {
            const tr = document.createElement('tr');

            // Opciones de proveedor
            let proveedorOptions = '<option value="">--Seleccione--</option>';
            proveedores.forEach(prov => {
                proveedorOptions += `<option value="${prov.id}">${prov.nombre}</option>`;
            });

            // Precio inicial (puede ser vac√≠o)
            let precioInicial = '';

            tr.innerHTML = `
                <td>
                    ${prod.ean}
                    <button onclick="pegarEAN('${prod.ean}')">üìã</button>
                </td>
                <td>
                <input type="text" value="${prod.nombre}" data-ean="${prod.ean}" class="nombre-edit" style="width: 120px">
                <button onclick="guardarNombre(this)">üíæ</button>
                </td>

                <td>
                <input type="number" min="0" value="${prod.stock != null ? prod.stock : ''}" data-ean="${prod.ean}" />
                        <button onclick="actualizarStock(this)">üíæ</button>
                </td>

                <td>
                <input type="number" min="0" step="0.01" value="${prod.precio_venta ?? ''}" data-ean="${prod.ean}" class="input-precio-venta">
                <button onclick="guardarPrecioVenta(this)">üíæ</button>
                </td>

                <td>
                    <input type="number" step="any" data-ean="${prod.ean}" value="${prod.gramos}" />
                    <button onclick="guardarGramos(this)">üíæ</button>
                </td>
                <td>${prod.descripcion || ''}</td>
                <td>
                    <input type="text" value="${prod.marca_nombre}" data-ean="${prod.ean}" class="marca-edit" style="width: 100px">
                    <button onclick="guardarMarca(this)">üíæ</button>
                </td>
                <td>
                    <input type="text" value="${prod.categoria_nombre}" data-ean="${prod.ean}" class="categoria-edit" style="width: 100px" list="listaCategorias">
                    <button onclick="guardarCategoria(this)">üíæ</button>
                </td>
                <td>
                    <input type="number" step="0.01" min="0" value="${precioInicial}" data-ean="${prod.ean}" placeholder="Precio"/>
                    <select class="proveedor-select">
                        ${proveedorOptions}
                    </select>
                    <button onclick="guardarPrecio(this)">üíæ</button>
                    <button onclick="eliminarPrecio(this)" title="Eliminar precio" style="color:red;">üóëÔ∏è</button>
                </td>
            `;

            // L√≥gica para actualizar el precio al cambiar proveedor
            const precioInput = tr.querySelector('input[type="number"][placeholder="Precio"]');
            const proveedorSelect = tr.querySelector('select.proveedor-select');

            proveedorSelect.addEventListener('change', function () {
                const proveedorId = this.value;
                const precioObj = preciosTodos.find(
                    p => p.producto === prod.ean && String(p.proveedor) === proveedorId
                );
                precioInput.value = precioObj ? precioObj.precio : '';
            });

            tbody.appendChild(tr);
        });
    });
}

async function cargarProveedoresFiltro() {
    try {
        const res = await fetch('/proveedores');
        const data = await res.json();
        const select = document.getElementById('filtroProveedor');
        select.innerHTML = '<option value="">-- Mostrar todos --</option>';
        data.forEach(prov => {
            const option = document.createElement('option');
            option.value = prov.id;
            option.textContent = prov.nombre;
            select.appendChild(option);
        });
    } catch (e) {
        console.error('Error al cargar proveedores (filtro):', e);
    }
}

function pegarEAN(ean) {
    const input = document.getElementById('productoPrecio');
    input.value = ean;
    input.focus();
    input.select(); // Opcional: selecciona el texto para que se sobrescriba f√°cil
}

function borrarPrecio() {
    document.getElementById('precio').value = '';
    document.getElementById('precio').focus();
}

async function guardarNombre(button) {
    const input = button.previousElementSibling;
    const nuevoNombre = input.value.trim();
    const ean = input.dataset.ean;

    if (!nuevoNombre) {
        alert('El nombre no puede estar vac√≠o.');
        return;
    }

    try {
        const res = await fetch(`/productos/${ean}/nombre`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nombre: nuevoNombre })
        });

        const msg = await res.text();
        alert(msg);

        if (res.ok) {
            await filtrarProductos(); // refrescar tabla
        }
    } catch (err) {
        console.error('Error al actualizar el nombre:', err);
        alert('Error al actualizar el nombre');
    }
}


async function guardarMarca(button) {
    const input = button.previousElementSibling;
    const nuevaMarca = input.value.trim();
    const ean = input.dataset.ean;

    if (!nuevaMarca) {
        alert('La marca no puede estar vac√≠a.');
        return;
    }

    try {
        const res = await fetch(`/productos/${ean}/marca`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nombreMarca: nuevaMarca })
        });

        const msg = await res.text();
        alert(msg);

        if (res.ok) {
            await filtrarProductos(); // Refresca la tabla si hay filtros aplicados
        }
    } catch (err) {
        console.error('Error al actualizar la marca:', err);
        alert('Error al actualizar la marca');
    }
}

async function guardarCategoria(button) {
    const input = button.previousElementSibling;
    const nuevaCategoria = input.value.trim();
    const ean = input.dataset.ean;

    if (!nuevaCategoria) {
        alert('La categor√≠a no puede estar vac√≠a.');
        return;
    }

    try {
        const res = await fetch(`/productos/${ean}/categoria`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ nombreCategoria: nuevaCategoria })
        });

        const msg = await res.text();
        alert(msg);

        if (res.ok) {
            await filtrarProductos();
        }
    } catch (err) {
        console.error('Error al actualizar la categor√≠a:', err);
        alert('Error al actualizar la categor√≠a');
    }
}

async function guardarGramos(button) {
    const input = button.previousElementSibling;
    const gramos = parseFloat(input.value);
    const ean = input.dataset.ean;

    if (isNaN(gramos)) {
        alert('Los gramos deben ser un n√∫mero v√°lido.');
        return;
    }

    try {
        const res = await fetch(`/productos/${ean}/gramos`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ gramos })
        });

        const msg = await res.text();
        alert(msg);

        if (res.ok) {
            await filtrarProductos(); // o recargarTablaProductos();
        }
    } catch (err) {
        console.error('Error al actualizar los gramos:', err);
        alert('Error al actualizar los gramos');
    }
}

async function guardarPrecio(button) {
    const td = button.parentElement;
    const input = td.querySelector('input[type="number"]');
    const select = td.querySelector('select.proveedor-select');
    const precio = parseFloat(input.value.trim());
    const ean = input.dataset.ean;
    const proveedorId = select.value;

    if (!proveedorId) {
        alert('Debe seleccionar un proveedor.');
        return;
    }

    try {
        const res = await fetch('/precios', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                producto: ean,
                proveedor: proveedorId,
                precio
            })
        });

        const msg = await res.text();
        alert(msg);

        if (res.ok) {
            input.value = precio;
            //await filtrarProductos(); // Opcional: refrescar tabla
        }
    } catch (err) {
        console.error('Error al guardar precio:', err);
        alert('Error al guardar precio');
    }
}

async function guardarPrecioVenta(button) {
    const td = button.parentElement;
    const input = td.querySelector('.input-precio-venta');
    const precioVenta = parseFloat(input.value.trim());
    const ean = input.dataset.ean;

    if (isNaN(precioVenta) || precioVenta < 0) {
        alert('Ingrese un precio de venta v√°lido.');
        return;
    }

    try {
        const res = await fetch(`/productos/${ean}/precio-venta`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ precio_venta: precioVenta })
        });
        const msg = await res.text();
        alert(msg);
    } catch (err) {
        alert('Error al guardar el precio de venta');
    }
}

async function eliminarPrecio(button) {
    const td = button.parentElement;
    const input = td.querySelector('input[type="number"]');
    const select = td.querySelector('select.proveedor-select');
    const ean = input.dataset.ean;
    const proveedorId = select.value;

    if (!proveedorId) {
        alert('Seleccione un proveedor para eliminar el precio.');
        return;
    }

    if (!confirm('¬øSeguro que desea eliminar el precio para este proveedor?')) return;

    try {
        const res = await fetch(`/precios`, {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ producto: ean, proveedor: proveedorId })
        });
        const msg = await res.text();
        alert(msg);
        if (res.ok) {
            input.value = '';
        }
    } catch (err) {
        console.error('Error al eliminar precio:', err);
        alert('Error al eliminar precio');
    }
}

const inputBuscarNombre = document.getElementById('buscarNombre');
const btnBuscarNombre = document.getElementById('btnBuscarNombre');
const btnLimpiarNombre = document.getElementById('btnLimpiarNombre');

async function filtrarProductos() {
    const categoriaId = document.getElementById('filtroCategoria').value;
    const proveedorId = document.getElementById('filtroProveedor').value;
    const marcaId = document.getElementById('filtroMarca').value;
    const eanBuscado = document.getElementById('buscarEan').value.trim();
    const nombreBuscado = inputBuscarNombre.value.trim();

    let url = '/productos';
    const params = new URLSearchParams();

    if (categoriaId) {
        params.append('categoriaId', categoriaId);
    }
    if (proveedorId) {
        params.append('proveedorId', proveedorId);
    }
    if (marcaId) {
        params.append('marcaId', marcaId);
    }
    if (eanBuscado) {
        params.append('ean', eanBuscado);
    }
    if (nombreBuscado) {
        params.append('nombre', nombreBuscado);
    }

    if (params.toString()) {
        url += `?${params.toString()}`;
    }

    const res = await fetch(url);
    let data = await res.json();

    // Aplica el filtro de stock aqu√≠, combinando con los dem√°s
    if (filtroStockActivo) {
        data = data.filter(prod => prod.stock > 0);
    }

    mostrarProductos(data);
}

async function actualizarStock(boton) {
    const input = boton.previousElementSibling;
    const stock = input.value;
    const ean = input.dataset.ean;

    try {
        const res = await fetch(`/productos/${ean}/stock`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ stock: parseInt(stock) })
        });

        const result = await res.json();
        alert(result.mensaje);
    } catch (error) {
        console.error('Error al actualizar stock:', error);
        alert('Error al actualizar stock');
    }
}


document.getElementById('filtroCategoria').addEventListener('change', filtrarProductos);
document.getElementById('filtroProveedor').addEventListener('change', filtrarProductos);
document.getElementById('filtroMarca').addEventListener('change', filtrarProductos);

document.getElementById('btnBuscarEan').addEventListener('click', filtrarProductos);
document.getElementById('btnLimpiarEan').addEventListener('click', () => {
    document.getElementById('buscarEan').value = ''; // Limpiar el campo
    filtrarProductos(); // Volver a cargar los productos sin el filtro de EAN
});
// Tambi√©n puedes querer que al presionar enter en el campo EAN se busque
document.getElementById('buscarEan').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault(); // Evita que el formulario se env√≠e
        filtrarProductos();
    }
});

btnBuscarNombre.addEventListener('click', filtrarProductos);

btnLimpiarNombre.addEventListener('click', () => {
    inputBuscarNombre.value = ''; // Limpiar el campo
    filtrarProductos(); // Volver a cargar los productos sin el filtro de nombre
});

inputBuscarNombre.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault(); // Evita que el formulario se env√≠e si el input est√° dentro de un form
        filtrarProductos();
    }
});

document.getElementById('btn-informe-compras').onclick = async function() {
    const res = await fetch('/compras');
    const compras = await res.json();
    // Obtener productos con categor√≠a
    const resProd = await fetch('/productos');
    const productos = await resProd.json();
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Agrupa y toma solo la √∫ltima compra de cada producto+gramos
    const ultimasCompras = {};
    compras.forEach(compra => {
        const clave = `${compra.producto_nombre}||${compra.gramos}`;
        if (
            !ultimasCompras[clave] ||
            new Date(compra.fecha) > new Date(ultimasCompras[clave].fecha)
        ) {
            ultimasCompras[clave] = compra;
        }
    });

    // Une con la categor√≠a
    Object.values(ultimasCompras).forEach(compra => {
        const prod = productos.find(p => 
            p.nombre === compra.producto_nombre && 
            String(p.gramos || '') === String(compra.gramos || '')
        );
        compra.categoria_nombre = prod ? prod.categoria_nombre : 'Sin categor√≠a';
    });

    // Agrupa por categor√≠a
    const comprasPorCategoria = {};
    Object.values(ultimasCompras).forEach(compra => {
        const cat = compra.categoria_nombre || 'Sin categor√≠a';
        if (!comprasPorCategoria[cat]) comprasPorCategoria[cat] = [];
        comprasPorCategoria[cat].push(compra);
    });

    doc.setFontSize(9);
    doc.text('Informe de Compras (√∫ltima por producto, ordenado por categor√≠a)', 10, 10);

    let y = 18;
    let col1x = 10;
    let col2x = 110;
    for (const categoria of Object.keys(comprasPorCategoria).sort()) {
        doc.setFont(undefined, 'bold');
        doc.text(`${categoria}:`, 10, y);
        doc.setFont(undefined, 'normal');
        y += 6;
        let col = 0;
        comprasPorCategoria[categoria].forEach(compra => {
            const texto = `${compra.producto_nombre} (${compra.gramos || ''}g) - $${compra.precio_compra}`;
            if (col === 0) {
                doc.text(texto, col1x, y);
                col = 1;
            } else {
                doc.text(texto, col2x, y);
                col = 0;
                y += 6;
            }
            if (y > 280) { doc.addPage(); y = 18; }
        });
        // Si hay una fila sola al final, salta la l√≠nea
        if (col === 1) y += 6;
        y += 2; // Espacio extra entre categor√≠as
    }

    doc.save('informe-compras.pdf');
};

document.getElementById('ingresar').addEventListener('keydown', function (e) {
    const esEnter = e.key === 'Enter';
    const esInput = e.target.tagName === 'INPUT';
    const esBotonSubmit = e.target.type === 'submit';

    // Si se presion√≥ Enter en un input (no en el bot√≥n), cancelar el env√≠o
    if (esEnter && esInput && !esBotonSubmit) {
        e.preventDefault();
    }
});
    
    cargarCategorias();
    cargarCategoriasSelect();
    cargarProveedoresFiltro();
    cargarMarcasFiltro();
    cargarProductos();

    </script>
</body>
</html>